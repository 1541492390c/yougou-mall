<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="per.ccm.ygmall.product.mapper.SkuMapper">
    <resultMap id="skuVOMap" type="per.ccm.ygmall.product.vo.SkuVO">
        <id column="sku_id" property="skuId" jdbcType="BIGINT" />
        <result column="product_id" property="productId" jdbcType="BIGINT" />
        <result column="sku_stock" property="skuStock" jdbcType="INTEGER" />
        <result column="price" property="price" jdbcType="DECIMAL" />
        <result column="description" property="description" jdbcType="VARCHAR" />
        <collection property="skuSpecs" ofType="per.ccm.ygmall.product.vo.SkuSpecsVO" fetchType="eager">
            <result column="attr_name" property="attrName" jdbcType="VARCHAR" />
            <result column="attr_value_name" property="attrValueName" jdbcType="VARCHAR" />
        </collection>
    </resultMap>

    <sql id="sku_vo_column">
        sku.`sku_id`,
        sku.`product_id`,
        sku.`sku_stock`,
        sku.`price`,
        sku.`description`,
        sku_specs.`attr_name`,
        sku_specs.`attr_value_name`
    </sql>

    <sql id="sku_left_join_sku_specs">
        FROM sku LEFT JOIN sku_specs ON sku.`sku_id` = sku_specs.`sku_id`
    </sql>

    <select id="selectSkuList" resultMap="skuVOMap">
        SELECT <include refid="sku_vo_column" /> <include refid="sku_left_join_sku_specs" /> WHERE sku.`product_id` = #{productId}
    </select>

    <select id="selectSkuListBySkuIdList" resultMap="skuVOMap">
        SELECT <include refid="sku_vo_column" /> <include refid="sku_left_join_sku_specs" /> WHERE sku.`sku_id` IN
        <foreach collection="skuIdList" item="skuId" open="(" close=")" separator=",">
            #{skuId}
        </foreach>
    </select>
</mapper>